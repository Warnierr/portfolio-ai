export interface ProjectRecommendation {
  name: string
  description: string
  tech: string[]
  impact: string
  url?: string
}

export interface UserContext {
  currentSection: string
  timeOnSite: number
  interactions: any[]
  referrer: string
}

export interface AIResponse {
  content: string
  intent: string
  confidence: number
  actions?: string[]
}

// Base de connaissances sur Raouf WARNIER
const RAOUF_KNOWLEDGE_BASE = {
  profile: {
    name: "Raouf WARNIER",
    title: "Ing√©nieur IA & Data",
    company: "Inetum-Orange",
    education: "Master Data Science - ESIEE Paris",
    location: "France",
    experience: "3+ ans en IA/ML",
    specialization: "Intelligence Artificielle, Big Data, Agents Conversationnels"
  },
  
  projects: [
    {
      name: "Nina AI",
      description: "Agent conversationnel intelligent avec NLP avanc√©",
      tech: ["Python", "OpenAI", "LangChain", "FastAPI"],
      impact: "Automatisation de 80% des interactions client",
      category: "IA Conversationnelle"
    },
    {
      name: "Predictive Analytics Engine",
      description: "Syst√®me de pr√©diction pour l'e-commerce avec ML",
      tech: ["TensorFlow", "Scikit-learn", "Apache Spark"],
      impact: "Augmentation de 25% du taux de conversion",
      category: "Machine Learning"
    },
    {
      name: "Real-time Data Pipeline",
      description: "Pipeline de donn√©es temps r√©el pour analytics",
      tech: ["Apache Kafka", "Python", "Docker", "Kubernetes"],
      impact: "Traitement de 1M+ √©v√©nements/jour",
      category: "Big Data"
    },
    {
      name: "Computer Vision Classifier",
      description: "Classification d'images avec deep learning",
      tech: ["PyTorch", "OpenCV", "CUDA"],
      impact: "Pr√©cision de 94% sur dataset custom",
      category: "Computer Vision"
    },
    {
      name: "NLP Sentiment Analyzer",
      description: "Analyse de sentiment multilingue en temps r√©el",
      tech: ["Transformers", "BERT", "spaCy"],
      impact: "Analyse de 10K+ avis clients/heure",
      category: "NLP"
    },
    {
      name: "Recommender System",
      description: "Syst√®me de recommandation hybride personnalis√©",
      tech: ["Collaborative Filtering", "Matrix Factorization"],
      impact: "Am√©lioration de 30% de l'engagement",
      category: "Recommandation"
    },
    {
      name: "Fraud Detection ML",
      description: "D√©tection de fraude avec algorithmes ML avanc√©s",
      tech: ["XGBoost", "Isolation Forest", "SHAP"],
      impact: "R√©duction de 60% des fraudes d√©tect√©es",
      category: "S√©curit√© IA"
    },
    {
      name: "Time Series Forecasting",
      description: "Pr√©diction de s√©ries temporelles pour la finance",
      tech: ["LSTM", "Prophet", "ARIMA"],
      impact: "Pr√©cision de pr√©diction √† 85%",
      category: "Forecasting"
    }
  ],
  
  skills: {
    "Langages": ["Python", "R", "SQL", "JavaScript", "TypeScript"],
    "IA/ML": ["TensorFlow", "PyTorch", "Scikit-learn", "OpenAI", "Hugging Face"],
    "Big Data": ["Apache Spark", "Kafka", "Hadoop", "Elasticsearch"],
    "Cloud": ["AWS", "Azure", "Google Cloud", "Docker", "Kubernetes"],
    "Databases": ["PostgreSQL", "MongoDB", "Redis", "InfluxDB"],
    "Web": ["FastAPI", "Flask", "Node.js", "Vue.js", "Nuxt.js"]
  },
  
  services: [
    {
      name: "D√©veloppement d'Agents IA",
      description: "Cr√©ation d'agents conversationnels intelligents comme Nina AI",
      price: "4500‚Ç¨",
      duration: "4-6 semaines"
    },
    {
      name: "Solutions ML Personnalis√©es",
      description: "D√©veloppement de mod√®les ML sur mesure pour vos donn√©es",
      price: "3500‚Ç¨",
      duration: "3-5 semaines"
    },
    {
      name: "Pipeline Big Data",
      description: "Architecture compl√®te de traitement de donn√©es massives",
      price: "5500‚Ç¨",
      duration: "6-8 semaines"
    },
    {
      name: "Audit IA & Strat√©gie",
      description: "√âvaluation et recommandations pour int√©grer l'IA",
      price: "1500‚Ç¨",
      duration: "1-2 semaines"
    },
    {
      name: "Formation IA/ML",
      description: "Formation √©quipes sur les technologies IA modernes",
      price: "2500‚Ç¨",
      duration: "2-3 semaines"
    },
    {
      name: "Optimisation Mod√®les IA",
      description: "Am√©lioration performance et d√©ploiement mod√®les existants",
      price: "2000‚Ç¨",
      duration: "2-4 semaines"
    }
  ],
  
  contact: {
    email: "raouf.warnier@email.com",
    linkedin: "linkedin.com/in/raouf-warnier",
    github: "github.com/raouf-warnier",
    location: "France (Remote possible)",
    availability: "Disponible pour nouveaux projets"
  }
}

export const useNinaAI = () => {
  
  // Analyse de l'intention utilisateur
  const analyzeUserIntent = async (message: string): Promise<string> => {
    const lowerMessage = message.toLowerCase()
    
    // Classification simple des intentions
    if (lowerMessage.includes('projet') || lowerMessage.includes('r√©alisation')) {
      return 'projects'
    }
    if (lowerMessage.includes('comp√©tence') || lowerMessage.includes('skill') || lowerMessage.includes('technologie')) {
      return 'skills'
    }
    if (lowerMessage.includes('nina') || lowerMessage.includes('agent') || lowerMessage.includes('chatbot')) {
      return 'nina'
    }
    if (lowerMessage.includes('contact') || lowerMessage.includes('email') || lowerMessage.includes('joindre')) {
      return 'contact'
    }
    if (lowerMessage.includes('networking') || lowerMessage.includes('r√©seau') || lowerMessage.includes('collaboration') || lowerMessage.includes('partenariat')) {
      return 'networking'
    }
    if (lowerMessage.includes('consultation') || lowerMessage.includes('mentoring') || lowerMessage.includes('conseil')) {
      return 'consultation'
    }
    if (lowerMessage.includes('speaking') || lowerMessage.includes('conf√©rence') || lowerMessage.includes('pr√©sentation')) {
      return 'speaking'
    }
    if (lowerMessage.includes('service') || lowerMessage.includes('prix') || lowerMessage.includes('tarif')) {
      return 'services'
    }
    if (lowerMessage.includes('formation') || lowerMessage.includes('√©ducation') || lowerMessage.includes('dipl√¥me')) {
      return 'education'
    }
    if (lowerMessage.includes('exp√©rience') || lowerMessage.includes('parcours') || lowerMessage.includes('carri√®re')) {
      return 'experience'
    }
    
    return 'general'
  }
  
  // G√©n√©ration de r√©ponse intelligente
  const generateResponse = async (
    message: string, 
    intent: string, 
    context: { conversationHistory: any[], userContext: UserContext }
  ): Promise<AIResponse> => {
    
    let response = ""
    let actions: string[] = []
    
    switch (intent) {
      case 'projects':
        response = generateProjectsResponse(message)
        actions = ['view-projects', 'download-cv']
        break
        
      case 'skills':
        response = generateSkillsResponse(message)
        actions = ['download-cv', 'view-projects']
        break
        
      case 'nina':
        response = generateNinaResponse(message)
        actions = ['view-projects', 'contact']
        break
        
      case 'contact':
        response = generateContactResponse(message)
        actions = ['contact-form', 'download-cv']
        break
        
      case 'networking':
        response = generateNetworkingResponse(message)
        actions = ['open-networking-hub', 'book-consultation', 'open-calendar']
        break
        
      case 'consultation':
        response = generateConsultationResponse(message)
        actions = ['book-consultation', 'open-calendar', 'download-cv']
        break
        
      case 'speaking':
        response = generateSpeakingResponse(message)
        actions = ['propose-speaking', 'view-expertise', 'contact-form']
        break
        
      case 'services':
        response = generateServicesResponse(message)
        actions = ['contact-form', 'view-services']
        break
        
      case 'education':
        response = generateEducationResponse(message)
        actions = ['download-cv']
        break
        
      case 'experience':
        response = generateExperienceResponse(message)
        actions = ['download-cv', 'view-projects']
        break
        
      default:
        response = generateGeneralResponse(message, context)
        actions = ['view-projects', 'contact-form']
    }
    
    return {
      content: response,
      intent,
      confidence: 0.85,
      actions
    }
  }
  
  // G√©n√©rateurs de r√©ponses sp√©cialis√©es
  const generateProjectsResponse = (message: string): string => {
    const projects = RAOUF_KNOWLEDGE_BASE.projects
    const featuredProjects = projects.slice(0, 3)
    
    let response = "üöÄ **Projets IA de Raouf** :\n\n"
    
    featuredProjects.forEach(project => {
      response += `**${project.name}** - ${project.description}\n`
      response += `üí° Impact: ${project.impact}\n`
      response += `üõ†Ô∏è Tech: ${project.tech.join(', ')}\n\n`
    })
    
    response += `Et ${projects.length - 3} autres projets innovants ! Raouf a une expertise particuli√®re en **${projects[0].category}** avec Nina AI comme projet phare.`
    
    return response
  }
  
  const generateSkillsResponse = (message: string): string => {
    const skills = RAOUF_KNOWLEDGE_BASE.skills
    
    let response = "üõ†Ô∏è **Comp√©tences techniques de Raouf** :\n\n"
    
    Object.entries(skills).forEach(([category, skillList]) => {
      response += `**${category}** : ${skillList.join(', ')}\n`
    })
    
    response += `\nüí™ Avec **${RAOUF_KNOWLEDGE_BASE.profile.experience}**, Raouf ma√Ætrise particuli√®rement l'√©cosyst√®me IA moderne et les architectures cloud scalables.`
    
    return response
  }
  
  const generateNinaResponse = (message: string): string => {
    const ninaProject = RAOUF_KNOWLEDGE_BASE.projects[0] // Nina AI
    
    return `ü§ñ **Nina AI** est le projet phare de Raouf !\n\n` +
           `${ninaProject.description}\n\n` +
           `**Technologies** : ${ninaProject.tech.join(', ')}\n` +
           `**Impact** : ${ninaProject.impact}\n\n` +
           `Nina repr√©sente l'expertise de Raouf en IA conversationnelle. C'est un agent intelligent capable de comprendre le contexte, d'apprendre et de s'adapter aux utilisateurs. Un vrai concentr√© d'innovation ! üöÄ`
  }
  
  const generateContactResponse = (message: string): string => {
    const contact = RAOUF_KNOWLEDGE_BASE.contact
    
    return `üìû **Contacter Raouf** :\n\n` +
           `‚úâÔ∏è Email : ${contact.email}\n` +
           `üíº LinkedIn : ${contact.linkedin}\n` +
           `üêô GitHub : ${contact.github}\n` +
           `üìç Localisation : ${contact.location}\n\n` +
           `${contact.availability} ! Il sera ravi d'√©changer sur vos projets IA. ü§ù`
  }

  const generateNetworkingResponse = (message: string): string => {
    return `ü§ù **Networking avec Raouf** :\n\n` +
           `Raouf est tr√®s actif dans l'√©cosyst√®me IA fran√ßais ! Il propose plusieurs types d'interactions :\n\n` +
           `üî• **Consultation gratuite** (45 min) - Analysons ensemble vos besoins IA\n` +
           `üè¢ **Collaboration projet** - Partenariats techniques innovants\n` +
           `üéì **Mentoring** - Accompagnement personnalis√© d√©veloppeurs/entrepreneurs\n` +
           `üé§ **Speaking** - Interventions sur l'IA conversationnelle et Nina AI\n` +
           `üí° **Advisory** - Conseil strat√©gique pour startups IA\n\n` +
           `Rejoignez son r√©seau professionnel et d√©couvrons ensemble comment l'IA peut transformer vos projets ! üöÄ`
  }

  const generateConsultationResponse = (message: string): string => {
    return `üí° **Consultation IA avec Raouf** :\n\n` +
           `üÜì **Consultation d√©couverte GRATUITE** (45 min)\n\n` +
           `Ce que vous obtiendrez :\n` +
           `‚úÖ Analyse de vos besoins IA sp√©cifiques\n` +
           `‚úÖ Recommandations techniques personnalis√©es\n` +
           `‚úÖ Roadmap d'impl√©mentation claire\n` +
           `‚úÖ √âvaluation ROI et faisabilit√©\n\n` +
           `Parfait pour :\n` +
           `‚Ä¢ Entrepreneurs voulant int√©grer l'IA\n` +
           `‚Ä¢ CTOs √©valuant les opportunit√©s IA\n` +
           `‚Ä¢ √âquipes cherchant expertise technique\n\n` +
           `R√©servez votre cr√©neau maintenant ! üìÖ`
  }

  const generateSpeakingResponse = (message: string): string => {
    return `üé§ **Raouf Speaker IA** :\n\n` +
           `Raouf intervient r√©guli√®rement sur :\n\n` +
           `üî• **Sujets d'expertise** :\n` +
           `‚Ä¢ IA Conversationnelle et Agents Intelligents\n` +
           `‚Ä¢ Nina AI : Retour d'exp√©rience concret\n` +
           `‚Ä¢ Int√©gration IA en entreprise\n` +
           `‚Ä¢ Futur de l'interaction Human-AI\n` +
           `‚Ä¢ Innovation tech et √©cosyst√®me fran√ßais\n\n` +
           `üìä **Formats** :\n` +
           `‚Ä¢ Keynotes (30-60 min)\n` +
           `‚Ä¢ Workshops techniques (2-4h)\n` +
           `‚Ä¢ Tables rondes et panels\n` +
           `‚Ä¢ Conf√©rences corporate\n\n` +
           `Contactez-le pour enrichir votre √©v√©nement avec une expertise IA de pointe ! üåü`
  }
  
  const generateServicesResponse = (message: string): string => {
    const services = RAOUF_KNOWLEDGE_BASE.services.slice(0, 3)
    
    let response = "üíº **Services IA de Raouf** :\n\n"
    
    services.forEach(service => {
      response += `**${service.name}** - ${service.price}\n`
      response += `${service.description}\n`
      response += `‚è±Ô∏è Dur√©e : ${service.duration}\n\n`
    })
    
    response += "Et bien plus encore ! Raouf propose des solutions sur mesure adapt√©es √† vos besoins sp√©cifiques."
    
    return response
  }
  
  const generateEducationResponse = (message: string): string => {
    const profile = RAOUF_KNOWLEDGE_BASE.profile
    
    return `üéì **Formation de Raouf** :\n\n` +
           `**${profile.education}**\n` +
           `Sp√©cialisation en ${profile.specialization}\n\n` +
           `Cette formation d'excellence √† l'ESIEE Paris lui a donn√© les bases solides en math√©matiques, statistiques et informatique n√©cessaires pour exceller en IA. üìä`
  }
  
  const generateExperienceResponse = (message: string): string => {
    const profile = RAOUF_KNOWLEDGE_BASE.profile
    
    return `üíº **Exp√©rience de Raouf** :\n\n` +
           `**${profile.title}** chez **${profile.company}**\n` +
           `${profile.experience} dans le domaine\n\n` +
           `Raouf a d√©velopp√© une expertise pointue en IA appliqu√©e, avec un focus sur les solutions pratiques et l'impact business. Son exp√©rience chez Inetum-Orange lui donne une vision entreprise pr√©cieuse. üè¢`
  }
  
  const generateGeneralResponse = (message: string, context: any): string => {
    const greetings = [
      "üëã Salut ! Je suis Nina, l'assistant IA de Raouf.",
      "ü§ñ Hello ! Nina ici, pr√™te √† parler de Raouf !",
      "‚ú® Coucou ! Nina √† votre service pour tout savoir sur Raouf !"
    ]
    
    const randomGreeting = greetings[Math.floor(Math.random() * greetings.length)]
    
    return `${randomGreeting}\n\n` +
           `Je peux vous parler de :\n` +
           `üöÄ Ses projets IA innovants\n` +
           `üõ†Ô∏è Ses comp√©tences techniques\n` +
           `üíº Ses services et tarifs\n` +
           `üìû Comment le contacter\n\n` +
           `Que voulez-vous savoir ? üòä`
  }
  
  // Recommandations de projets
  const getProjectRecommendations = async (): Promise<ProjectRecommendation[]> => {
    return RAOUF_KNOWLEDGE_BASE.projects.map(project => ({
      name: project.name,
      description: project.description,
      tech: project.tech,
      impact: project.impact
    }))
  }
  
  // G√©n√©ration de CV
  const generateCV = async (): Promise<Blob> => {
    // Simulation de g√©n√©ration de CV
    const cvContent = generateCVContent()
    return new Blob([cvContent], { type: 'application/pdf' })
  }
  
  const generateCVContent = (): string => {
    const profile = RAOUF_KNOWLEDGE_BASE.profile
    const skills = RAOUF_KNOWLEDGE_BASE.skills
    const projects = RAOUF_KNOWLEDGE_BASE.projects
    
    let cv = `CV - ${profile.name}\n`
    cv += `${profile.title} | ${profile.company}\n`
    cv += `${profile.education}\n\n`
    
    cv += "COMP√âTENCES TECHNIQUES\n"
    Object.entries(skills).forEach(([category, skillList]) => {
      cv += `${category}: ${skillList.join(', ')}\n`
    })
    
    cv += "\nPROJETS PRINCIPAUX\n"
    projects.slice(0, 5).forEach(project => {
      cv += `${project.name}: ${project.description}\n`
    })
    
    return cv
  }
  
  // Traitement de message (point d'entr√©e principal)
  const processMessage = async (
    message: string,
    context?: UserContext
  ): Promise<AIResponse> => {
    const intent = await analyzeUserIntent(message)
    const response = await generateResponse(message, intent, {
      conversationHistory: [],
      userContext: context || {
        currentSection: 'home',
        timeOnSite: 0,
        interactions: [],
        referrer: ''
      }
    })
    
    return response
  }
  
  return {
    processMessage,
    generateResponse,
    analyzeUserIntent,
    getProjectRecommendations,
    generateCV,
    RAOUF_KNOWLEDGE_BASE
  }
} 